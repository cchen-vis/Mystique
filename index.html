<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Mystique</title>
    <link
      rel="stylesheet"
      href="//code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      html {
        margin: 10px 10px 0px 10px;
        padding: 0px;
        font-family: Arial;
      }
      body {
        margin:0 15% 0 15%;
        padding: 0px;
        background: white;
        overflow-x: hidden;
        overflow-y: auto;
      }
      header img {
        float: left;
        width: 40px;
        height: 60px;
        background: white;
        margin: 0px 10px 0px 0px;
      }
      header h1 {
        font-size: 50px;
        font-weight: 600;
        color: #4f0599;
        text-shadow: 0px 0px 5px #b393d3, 0px 0px 10px #b393d3, 0px 0px 10px #b393d3,
            0px 0px 20px #b393d3;
      }
      /* header h1 {
        font-size: 50px;
        font-weight: 600;
        background-image: linear-gradient(to left, #553c9a, #b393d3);
        color: transparent;
        background-clip: text;
        -webkit-background-clip: text;
      } */
      header h2 {
        font-size: 25px;
        font-weight: 500;
        color: #553c9a;
        margin: 0px 0px 25px 0px;
      }
      .galleryDiv{
        width: 100%;
        border: 2px solid white;
        display: inline-block;
        margin: 0px 10px 0px 10px;
      }
      .columnName {
        max-width: 30%;
        min-width: 30%;
        height: 35px;
        vertical-align: text-bottom;
        text-align: center;
        border: 2px solid white;
        display: inline-block;
        margin: 0px 10px 0px 10px;
      }
      .galleryItem {
        max-width: 30%;
        min-width: 30%;
        height: 0;
        padding-bottom: 20%;
        vertical-align: text-bottom;
        text-align: center;
        border: 2px solid #eee;
        display: inline-block;
        margin: 10px 10px 0px 10px;
      }
      .galleryItem:hover {
        box-shadow: 0px 0px 5px #888;
        cursor: pointer;
      }
      #uploadData {
        margin: 40px 10px 5px 10px;
      }
      #uploadForm {
        margin: 20px 10px 50px 10px;
      }
      div.upload {
    background-color:#fff;
    border: 1px solid #ddd;
    border-radius:5px;
    display:inline-block;
    height: 30px;
    padding:3px 40px 3px 3px;
    position:relative;
    width: auto;
}

div.upload:hover {
    opacity:0.95;
}

div.upload input[type="file"] {
    display: input-block;
    width: 100%;
    height: 30px;
    opacity: 0;
    cursor:pointer;
    position:absolute;
    left:0;
}
.uploadButton {
    background-color: #425F9C;
    border: none;
    border-radius: 3px;
    color: #FFF;
    cursor:pointer;
    display: inline-block;
    height: 30px;
    margin-right:15px;
    width: auto;
    padding:0 20px;
    box-sizing: content-box;
}

.fileName {
    font-family: Arial;
    font-size:14px;
}

.upload + .uploadButton {
    height:38px;
}
    </style>
  </head>
  <body>
    <header>
        <img src="img/mystique.png" alt="logo" />
        <h1>Mystique</h1>
        <h2>Toward Interactive Reuse of Existing SVG Examples for Easy Chart Authoring</h2>
    </header>
    <div id="gallery">

    </div>
    <div id="uploadData">
        <h2> Experimental Feature: Upload Your Own SVG</h2>
        <h3> You can upload an SVG file as the input example and reuse it on your own dataset with Mystique. The SVG file needs to satisfy the following requirements:
            <ol>
                <li>
                    It is composed of rectangle marks only;
                </li>
                <li>
                    It needs to contain complete style information (e.g., fill and stroke). If such information is sometimes contained in the CSS file associated with the webpage in which the SVG is embedded in, you need to add this information to the SVG file. 
                </li>
            </ol>
        </h3>
        <!-- solution from http://jsfiddle.net/umhva747/ -->
        <form action="demoPage.html" id="uploadForm"> 
            <div class="upload">
                <input type="button" class="uploadButton" value="Browse" />
                <input type="file" name="upload" accept="image/*" id="myFile" />
                <span class="fileName">Select file..</span>
            </div>
            <input type="submit" class="uploadButton" value="Upload File" onClick="newSVG()"/>
        </form>

    </div>

    <script>  
      $('input[type=file]').change(function(e) {
            $in = $(this);
            $in.next().html($in.val().split('\\')[2]);
            
        });

      sessionStorage.setItem("svg", ""); 
    //   localStorage["svg"] = "";

      function newSVG() {
        let uploadedSVG = document.getElementById('myFile').files[0];
        let fileReader = new FileReader(); 
        fileReader.readAsText(uploadedSVG); 
        fileReader.onload = function() {
          console.log(fileReader.result);
          sessionStorage.setItem("svg", fileReader.result); 
        //   localStorage["svg"] = fileReader.result;
        }; 
        // url = 'http://localhost:8080/demoPage.html?filename=' + b;
        // document.location.href = url;
      }

      let metaData;

      function loadDemo(demo) {
        fetch("./examples/" + demo + ".svg")
          .then((resp) => {
            return resp.text();
          })
          .then((text) => {
            let jsonArr = flattenSVG(text);
            load_spec_from_file(text, demo);
            detect(jsonArr, demo);
          });
      }

      $(document).ready(() => {
        fetch("demos.json")
          .then((resp) => {
            return resp.text();
          })
          .then((text) => {
            let thisDemo = d3.select("#gallery")
                    .append("div")
                    .attr("class", "galleryDiv")   
            thisDemo.append("div").attr("class", "columnName").html("<b>Example</b> <br>(click to open the source page)");
            thisDemo.append("div").attr("class", "columnName").html("<b>New chart after reusing</b> <br>(click to try Mystique with this example)");
            thisDemo.append("div").attr("class", "columnName").html("<b>Explanation of the new chart</b> <br> (Instructions on object-data mappings)");
            metaData = JSON.parse(text);
            for (let k of Object.keys(metaData)) {
                let thisDemo = d3.select("#gallery")
                    .append("div")
                    .attr("class", "galleryDiv")   
                thisDemo.append("a")
                    .attr("class", "galleryItem")
                    .style("background", "white")
                    .style("background-image", 'url("galleryImg/' + metaData[k].svgFileName + '_before.png")')
                    .style("background-size", "contain")
                    .style("background-repeat", "no-repeat")
                    .style("background-position", "center")
                    .attr("href", metaData[k].url)
                thisDemo.append("a")
                    .attr("class", "galleryItem")
                    .style("background", "white")
                    .style("background-image", 'url("galleryImg/' + metaData[k].svgFileName + '_after.png")')
                    .style("background-size", "contain")
                    .style("background-repeat", "no-repeat")
                    .style("background-position", "center")
                    .attr("href", window.location.href + "demoPage.html#" + metaData[k].svgFileName)
                thisDemo.append("div")
                    .attr("class", "galleryItem")
                    .text(metaData[k].about);
            }
          });
      });
    </script>
  </body>
</html>
